<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>External Owner Info</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #f5f6fa;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: #333;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #fff;
      height: 80px;
      padding: 0 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .header-column {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-column:first-child {
      justify-content: flex-start;
    }

    .header-column img {
      height: 50px;
    }

    .header-column h1 {
      font-size: 20px;
      font-weight: 600;
      margin: 0;
      color: #2c3e50;
    }

    .footer button {
    font-size: 20px;
      font-weight: 300;
      padding: 10px;
      color: white;
      margin-left: -90%;
      background-color: #7e6ab6;
      border-radius: 8px;
    }

    main {
      display: flex;
      flex: 1;
      margin: 20px;
      gap: 20px;
    }

    .left-panel {
      width: 200px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .left-panel a {
      text-decoration: none;
      color: #2c3e50;
      background: #ffffff;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      transition: background 0.2s ease;
    }

    .left-panel a:hover {
      background-color: #ecf0f1;
    }


    .content1.expanded {
        width: 100%;
    }

    .content {
      flex: 1;
      background-color: #ffffff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.06);
    }

     .content1 {
      background-color: #ffffff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.06);
      min-width: 1000px;
    }

    .content1 button {
    font-size: 12px;
      font-weight: 100;
      padding: 10px;
      color: white;
      right: auto;
      background-color: #7e6ab6;
      border-radius: 8px;
      margin-left: 8%;
      width: 10%;
      align-items: flex;
    }

    .content h2 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    select, input[type="text"] {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #e0e0e0;
      text-align: left;
      padding: 12px;
      font-size: 14px;
    }

    th {
      background-color: #f1f3f5;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .copy-icon {
      cursor: pointer;
      margin-left: 8px;
      color: #999;
      transition: color 0.2s;
    }

    .copy-icon:hover {
      color: #2c3e50;
    }

    .pagination {
      margin-top: 20px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pagination button {
      padding: 6px 12px;
      border: none;
      background-color: #ecf0f1;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .pagination button.active {
      background-color: #3498db;
      color: white;
      font-weight: bold;
    }

    .hidden {
      display: none;
    }

.inputRender {
    padding: 10px;
      margin: 10px 0;
      width: 80%;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
}

iframe {
  flex: 1;
  min-width: 1000px;
  width: 100%;
  height: 100%;
  border: none;
}

    footer {
      background-color: #ffffff;
      padding: 15px 20px;
      text-align: center;
      font-size: 14px;
      color: #777;
      box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.05);
    }
  </style>
</head>
<body>

<header>
  <div class="header-column">
    <img src="./brand/nutiliti.svg" alt="Brand Logo">
  </div>
  <div class="header-column">
    <h1>External Owner Info</h1>
  </div>
  <div class="header-column">
  </div>
</header>

<main>
  <div class="left-panel" id="leftPanel">
    <a href="https://app.nutiliti.com/" target="_blank" rel="noopener noreferrer">Admin Portal</a>
    <a href="https:///app.clickup.com/" target="_blank" rel="noopener noreferrer">ClickUp</a>
    <a href="https://my.openphone.com/" target="_blank" rel="noopener noreferrer">Openphone</a>
    <a href="msteams:" onclick="setTimeout(() => { window.open('https://teams.microsoft.com', '_blank'); }, 500);" title="Open Microsoft Teams App">Microsoft Teams</a>
  </div>


<div class="content1">
       <input class="inputRender" id="iframeInput" placeholder="Enter Utility Account link here" />
    <button onclick="renderIframe()">Render</button>
     <iframe id="renderedIframe"></iframe>
     
</div>

  <div class="content">
    <select id="organizationDropdown" onchange="filterByOrganization()">
      <option value="" disabled selected>Select an Organization</option>
    </select>

    <input type="text" id="searchBox" placeholder="Search..." onkeyup="searchTable()" disabled />

    <div id="organizationProfile" class="organizationProfile hidden">
      <p id="orgDetails"></p>
    </div>

    <table id="ownerTable" class="hidden">
      <thead>
        <tr>
          <th>External Owner Name</th>
          <th>TIN</th>
          <th>Inbox</th>
          <th>Phone Number</th>
        </tr>
      </thead>
      <tbody id="dataTable"></tbody>
    </table>

    <div id="pagination" class="pagination hidden"></div>
  </div>
</main>

<footer class="footer">
<button class="toggle-left-panel" onclick="toggleLeftPanel()">Toggle Left Panel</button>
</footer>

<script>
let ownerData = [], filteredData = [], currentPage = 1, rowsPerPage = 15;
    
        async function fetchData() {
            try {
                const response = await fetch('data.json');
                ownerData = await response.json();
                populateDropdown();
                filteredData = [...ownerData]; // Default: show all data
                renderTable();
            } catch (error) {
                console.error("Error loading data:", error);
            }
        }
    
        function populateDropdown() {
            const orgSet = new Set(ownerData.map(item => item.Organization));
            const dropdown = document.getElementById("organizationDropdown");
            orgSet.forEach(org => {
                let option = document.createElement("option");
                option.value = org;
                option.textContent = org;
                dropdown.appendChild(option);
            });
        }
    
function filterByOrganization() {
    let selectedOrg = document.getElementById("organizationDropdown").value;
    let profile = document.getElementById("organizationProfile");
    let table = document.getElementById("ownerTable");
    let searchBox = document.getElementById("searchBox");
    let pagination = document.getElementById("pagination");

    profile.classList.toggle("hidden", !selectedOrg);
    table.classList.remove("hidden");
    searchBox.disabled = false;
    pagination.classList.remove("hidden");

    // Apply filtering by selected organization only
    filteredData = ownerData.filter(item => item.Organization === selectedOrg);

    currentPage = 1;
    renderTable();
}
    
        function renderTable() {
            const tableBody = document.getElementById("dataTable");
            tableBody.innerHTML = "";
            let start = (currentPage - 1) * rowsPerPage;
            let end = start + rowsPerPage;
            let paginatedData = filteredData.slice(start, end);
    
            paginatedData.forEach(item => {
                let row = `<tr>
                    <td><a href="external-owner.html?name=${encodeURIComponent(item["External Owner Name"])}}">${item["External Owner Name"]}</a> <span class='copy-icon' onclick='copyText("${item["External Owner Name"]}", this)'>&#128203;</span></td>
                    <td>${item["TIN"]} <span class='copy-icon' onclick='copyText("${item["TIN"]}", this)'>&#128203;</span></td>
                    <td>
    <a href="https://outlook.office.com/mail/${encodeURIComponent(item["Inbox"])}" target="_blank">
        ${item["Inbox"]}
    </a>
    <span class='copy-icon' onclick='copyText("${item["Inbox"]}", this)'>&#128203;</span>
</td>
                    <td>${item["Phone Number"]} <span class='copy-icon' onclick='copyText("${item["Phone Number"]}", this)'>&#128203;</span></td>
                </tr>`;
                tableBody.innerHTML += row;
            });
            renderPagination();
        }
    
        function renderPagination() {
            let pagination = document.getElementById("pagination");
            pagination.innerHTML = "";
            let totalPages = Math.ceil(filteredData.length / rowsPerPage);
    
            for (let i = 1; i <= totalPages; i++) {
                let button = document.createElement("button");
                button.textContent = i;
                button.onclick = () => { currentPage = i; renderTable(); };
                if (i === currentPage) button.style.fontWeight = "bold";
                pagination.appendChild(button);
            }
        }
    
function searchTable() {
    let input = document.getElementById("searchBox").value.trim().toLowerCase();

    // Don't search if no org is selected
    let selectedOrg = document.getElementById("organizationDropdown").value;
    if (!selectedOrg) return;

    // Split search into multiple terms
    let searchTerms = input.split(/\s+/).filter(term => term.length > 0);

    // Re-filter based on org (base) + search
    filteredData = ownerData.filter(item => {
        if (item.Organization !== selectedOrg) return false;

        let values = [
            item["External Owner Name"]?.toLowerCase() || '',
            item["TIN"]?.toLowerCase() || '',
            item["Phone Number"]?.toLowerCase() || '',
            item["Inbox"]?.toLowerCase() || ''
        ];

        return searchTerms.every(term =>
            values.some(field => field.includes(term))
        );
    });

    currentPage = 1;
    renderTable();
}
    
function copyText(text, iconElement) {
    navigator.clipboard.writeText(text).then(() => {
        // Change the icon to the checkmark
        iconElement.innerHTML = "&#10003;"; // Checkmark icon (✔)
        
        // Optionally, change the style (e.g., color)
        iconElement.style.color = "green"; // Green color for success

        // Reset to clipboard icon after 2 seconds
        setTimeout(() => {
            iconElement.innerHTML = "&#128203;"; // Clipboard icon (📋)
            iconElement.style.color = ""; // Reset color
        }, 10000); // Reset after 2 seconds
    }).catch(err => {
        console.error("Failed to copy text: ", err);
    });
}
    
        fetchData();

   function renderIframe() {
      const url = document.getElementById('iframeInput').value;
      if (url) {
        const formattedUrl = url.startsWith('http://') || url.startsWith('https://') ? url : 'https://' + url;
        document.getElementById('renderedIframe').src = formattedUrl;
      }
    }

    function toggleLeftPanel() {
      const panel = document.getElementById('leftPanel');
      panel.style.display = panel.style.display === 'none' ? 'flex' : 'none';
    }

  function renderIframe() {
    const url = document.getElementById('iframeInput').value;
    if (url) {
      document.getElementById('renderedIframe').src = url;
    }
  }
</script>
</body>
</html>


